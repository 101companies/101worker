<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>testAllExplorerEntities</title>
    <style type="text/css">
      /* <![CDATA[ */
      html, body {
        margin: 0;
        padding: 0;
      }

      h1 {
        margin: 0;
        padding: 20px;
        font: 30pt monospace;
        font-weight: bold;
        color: white;
        background: black;
      }

      /* === Overview ======================================================= */

      #overview {
        margin: 10px;
        padding: 0;
        background: white;
        border: 1px solid black;
        position: fixed;
        top: 0;
        right: 0;
        font-family: sans-serif;
        min-width: 320px;
      }

      #overview h2 {
        margin: 0;
        padding: 10px;
        font: 20pt monospace;
        font-weight: bold;
        color: white;
        background: black;
      }

      #overview h2 a {
        margin: 0;
        padding: 0;
        color: white;
      }

      #overview #total_errors {
        position: absolute;
        top: 17px;
        right: 10px;
        color: white;
        font: 10pt monospace;
      }

      #overview ul {
        margin: 0;
        padding: 0;
        list-style: none;
      }

      #overview li {
        margin: 0;
        padding: 0;
        list-style: none;
      }

      #overview a {
        margin: 5px;
        padding: 5px;
        text-decoration: none;
        display: block;
      }

      #overview .passed > a {
        color: #050;
        background: #5A5;
        border: 2px solid #585;
      }

      #overview .failed > a {
        color: #800;
        background: #F55;
        border: 2px solid #A55;
      }

      #overview li li a {
        padding-left: 25px;
        border: none;
        color: black;
        background: white;
        font-family: monospace;
        text-decoration: underline;
      }

      #overview .count {
        position: absolute;
        right: 12px;
      }

      /* === Errors ========================================================= */

      #errors {
        padding: 10px;
      }

      #errors h2 {
        margin: 30px -10px 10px -10px;
        padding: 20px;
        font: 20pt sans-serif;
      }

      #errors h2.passed {
        color: #050;
        background: #5A5;
      }

      #errors h2.failed {
        color: #800;
        background: #F55;
      }

      #errors h2 a:nth-child(2) {
        /* link to top */
        margin-left: 5px;
        color: inherit;
        font: 10pt monospace;
      }

      #errors .none {
        font-family: monospace;
      }

      #errors h3 {
        margin: 0;
        padding: 10px;
        font: 12pt monospace;
        color: white;
        background: black;
      }

      #errors ul {
        margin: 0;
        margin-bottom: 10px;
        padding: 0;
        list-style: none;
        border: 1px solid black;
        border-bottom: none;
      }

      #errors li {
        margin: 0;
        padding: 10px;
        list-style: none;
        border-bottom: 1px solid black;
      }

      #errors li.control {
        cursor: pointer;
        color: #08C;
        font: 12pt sans-serif;
      }

      #errors .entity_name {
        margin-left: 10px;
        font: 12pt serif;
        font-weight: bold;
      }

      #errors .entity_resource {
        margin-left: 10px;
        font-family: monospace;
      }

      #errors pre {
        clear: both;
        margin: 0;
        margin-top: 5px;
        padding: 10px;
        background: #EEE;
      }
      /* ]]> */
    </style>
    <script type="text/javascript">
      // <![CDATA[
      function delete_potential_control_buttons(ul) {
        controls = ul.getElementsByClassName("control");
        while (controls.length) {
          ul.removeChild(controls[0]);
          controls = ul.getElementsByClassName("control");
        }
      }

      function hide_similiar_entities(ul) {
        delete_potential_control_buttons(ul);

        // hide all but the first entities
        lis = ul.getElementsByTagName("li");
        for (var i = 1; i < lis.length; ++i) {
          lis[i].style.display = "none";
        }

        // append show button
        show = document.createElement("li");
        show.className = "control";
        show.textContent = "show " + (lis.length - 1) + " similar errors";
        show.onclick = function() {
          show_similiar_entities(ul);
        };
        ul.appendChild(show);
      }

      function show_similiar_entities(ul) {
        delete_potential_control_buttons(ul);

        lis = ul.getElementsByTagName("li");
        for (var i = 1; i < lis.length; ++i) {
          lis[i].style.display = 'block';
        }

        // append hide buttons
        hide1 = document.createElement("li");
        hide1.className = "control";
        hide1.textContent = "hide " + (lis.length - 1) + " similar errors";
        hide1.onclick = function() {
          hide_similiar_entities(ul);
        };

        hide2 = hide1.cloneNode(true);
        hide2.onclick = function() {
          hide_similiar_entities(ul);
        }

        ul.insertBefore(hide1, lis[1]);
        ul.appendChild(hide2);
      }

      errors = null

      window.onload = function() {
        errors = document.getElementById("errors");
        uls = errors.getElementsByTagName("ul");
        for (var i = 0; i != uls.length; ++i) {
          lis = uls[i].getElementsByTagName("li");
          if (lis.length > 1) {
            hide_similiar_entities(uls[i]);
          }
        }
      };
      // ]]>
    </script>
  </head>
  <body>
    <h1>testAllExplorerEntities</h1>

    <div id="overview">
      <h2><a name="overview" href="#top">Overview</a></h2>

      <div id="total_errors">
        Total Errors: {{ total_count }}
      </div>

      <ul>
        {% macro error_counts(title, anchor, errors) %}
          <li class="{% if errors.total_count == 0 %}passed{% else %}failed{% endif %}">
            <a href="#{{ anchor }}">
              {{ title }} Errors
              <span class="count">{{  errors.total_count }}</span>
            </a>
            <ul>
              {% for error, count in errors.error_counts.iteritems() %}
                <li>
                  <a href="#{{ anchor }}_{{ error }}">
                    {{ error }}
                    <span class="count">{{ count }}</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endmacro %}

        {{ error_counts("Root", "root", root_errors) }}
        {{ error_counts("Namespace", "namespace", namespace_errors) }}
        {{ error_counts("Member", "member", member_errors) }}
        {{ error_counts("Folder", "folder", folder_errors) }}
        {{ error_counts("File", "root", file_errors) }}
        {{ error_counts("Fragment", "fragment", fragment_errors) }}
      </ul>
    </div>

    <div id="errors">
      {% macro error_listing(title, anchor, errors) %}
        <h2 class="{% if not errors.error_list %}passed{% else %}failed{% endif %}">
          <a name="{{ anchor }}">{{ title }} Errors</a> <a href="#top">top</a>
        </h2>
        {% if not errors.error_list %}
          <div class="none">no errors</div>
        {% else %}
          {% for error, list in errors.error_list.iteritems() %}
            <h3><a name="{{ anchor }}_{{ error }}">{{ error }}</a></h3>
            <ul>
              {% for item in list %}
                <li>
                  <span class="entity_name">{{ item.entity.name }}</span>
                  <span class="entity_resource">{{ item.entity.resource }}</span>
                  <pre>{{ item.error }}</pre>
                </li>
              {% endfor %}
              <!--<li class="control">hide similiar errors</li>-->
            </ul>
          {% endfor %}
        {% endif %}
      {% endmacro %}

      {{ error_listing('Root', 'root', root_errors) }}
      {{ error_listing('Namespace', 'namespace', namespace_errors) }}
      {{ error_listing('Member', 'member', member_errors) }}
      {{ error_listing('Folder', 'folder', folder_errors) }}
      {{ error_listing('File', 'file', file_errors) }}
      {{ error_listing('Fragment', 'fragment', fragment_errors) }}
    </div>
  </body>
</html>
