#!/usr/bin/perl
use strict;
use warnings;
use Cwd                qw(abs_path);
use File::Basename     qw(dirname);
use YAML               qw(Load);

BEGIN { push @INC, dirname $0 }
use Runner101::Env     qw(load_vars);
use Runner101::Module;
use Runner101::Modules;


my $config     = do { local $/; YAML::Load(<STDIN>) } or die $!;
my $worker_dir = $ENV{worker101dir} // dirname dirname dirname abs_path $0;
our %options    = (
    config      => $config,
    worker      => $worker_dir,
    results     => ($ENV{results101dir} // dirname $worker_dir),
    modules_dir => ($ENV{modules101dir} // "$worker_dir/modules"),
);

load_vars(\%options);

my $diff = Runner101::Modules::run(\%options);
print $_, "\n" for @$diff;
