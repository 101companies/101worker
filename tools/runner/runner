#!/usr/bin/perl
use strict;
use warnings;
use Cwd            qw(abs_path);
use File::Basename qw(dirname);
use Getopt::Long;
use YAML           qw(Load);
BEGIN { push @::INC, dirname $0 }
use Runner101::Env qw(load_vars);


my $config     = do { local $/; YAML::Load(<STDIN>) } or die $!;
my $worker_dir = dirname dirname dirname abs_path $0;
my %options    = (
    root_dir    => dirname $worker_dir,
    modules_dir => "$worker_dir/modules",
);
GetOptions(\%options, qw(root=s modules=s));

chdir $options{root_dir} or die "Could not cd into $options{root_dir}: $!";
load_vars($config);

Runner101::Modules::run(\%options);
